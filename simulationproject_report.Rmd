---
title: "Simulation Project Report"
author: "Luyan Yao"
date: "4/30/2017"
output: word_document
---
## Title : A simulated study that shows Nutrients from Fruit and Vegetable Consumption Reversely Associate With Pancreatic Cancer.
##### Reference Links: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3694591/
# Introduction:
Pancreatic cancer is a devastating disease and is diagnosed at a late stage 3 and prognosis is extremely poor with 1-year and 5-year survival rates of 25% and 4%. Therefore, one important strategy at present is to focus on modifiable risk factor identification as a prevention strategy.However, for macronutrients, the evidence from both case-control and adequately powered cohort studies remains inconclusive.Therefore, this study was to evaluate the risk of pancreatic cancer associated with nutrients found in fruits and vegetables and nutrient supplementation using a clinic-based case-control design. 

# Methods:
This simulated dataset was generated based on the article. Participants were  asked to complete a 144-item food frequency questionnaire (FFQ) to address possible dietary causes of pancreatic cancer. The National Cancer Institute (NCI) software DietCalc was used to estimate average nutrient intake from the survey questions for the 5 years prior to enrollment.Fianlly, 384 cases and 985 controls composed the study sample. In the simulation project, case dataset and control dataset were conbined together, then Pearson corrlation and  logistice regression model were used to reveal relationship between each nutrients and pancreatic cancer. Meanwhile, predictor variables age, drinks of alcohol per week, diabetes history were add to see if they could affect the outcome and change the nutrient categories in significance.

### Predictor variables:

#### Demorgraphic and clinical variables 

1. Age: normal distribution. case: mean=67.5, sd=10; control: mean=66.5, sd=10.
2. Drinks: how many drinks per week. Uniform distribution. Both groups have min=0 and max=11.
3. Diabetes: 

  * Four levels Y(>=3years), Y(<3years),N, Missing. 
  * Proporation of each level in each grapup: Case: .09, .31,.56,.04; control: .04, .02,.93,.01
  
#### Nutrient predictor variables: 

These variables represent the nutrient intake based on 1000 calorie food. The data wase generated by constructing quintiles of intakes Based on controls using uniform distribution. With increasing in quintile, the odd ratio of haveing cancer is decreased.

4.magnesium

5.potassium

6.selenium

7.betacarotene: beta-carotene

8.lutein: lutien and zeaxanthin

9.niacin

10.alphacarotene: alpha-carotene

11.vitaminB6: vitamin B6

12.vitaminC: vitamin C

### Response variable:

Cancer: case group: have pancreatic cancer (1); control group: do not have pancreatic cancer (0).

#### Codes for data simulation

Simulate case and control data set respectively. 
```{r}
library(dplyr)
library(corrplot)
library(ggplot2)
set.seed(123)

# Drinks
drinkscase<-runif(384, max=11, min=0)
drinkscontrol<-runif(985, max=11, min=0)
# Age
agecase<-function(N){
  age <- round(rnorm(N,mean=67.5,sd=10))}
age_case<-agecase(384)
agecontrol<-function(N){
  age <- rnorm(n=N,mean=66.5,sd=10)}
age_control<-agecontrol(985)
# Diabetes
diabetecase <-sample(c("Y(>=3years)", "Y(<3years)","N","Missing"), 384, replace=TRUE, prob=c(.09, .31,.56,.04))
diabetecontrol<-sample(c("Y(>=3years)", "Y(<3years)","N","Missing"), 985, replace=TRUE, prob=c(.04, .02,.93,.01))
```

```{r}
#Mg
magcase<-function(){
mag1<-runif(120, min=46.82, max=164.82)
mag2<-runif(89, min=164.84, max=189.14)
mag3<-runif(59, min=189.21, max=205.39)
mag4<-runif(72, min=205.82, max=233.97)
mag5<-runif(44, min=234.32, max=430.3)
magvalue<-c(mag1,mag2,mag3,mag4,mag5)
}
magcase_data<-magcase()

magcontrol<-function(N){
  mag1<-runif(N, min=46.82, max=164.82)
  mag2<-runif(N, min=164.84, max=189.14)
  mag3<-runif(N, min=189.21, max=205.39)
  mag4<-runif(N, min=205.82, max=233.97)
  mag5<-runif(N, min=234.32, max=430.3)
  magvalue<-c(mag1,mag2,mag3,mag4,mag5)
}
magcontrol_data<-magcontrol(N=197)

# potassium
potassiumcase<-function(){
    p1<-runif(123, min=371.38, max=1573.24)
    p2<-runif(100, min=1573.85, max=1782.51)
    p3<-runif(67, min=1783.26, max=1956.03)
    p4<-runif(64, min=1958.1,  max=2234.83)
    p5<-runif(30, min=2236.52, max=4401.3)
    pvalue<-c(p1,p2,p3,p4,p5)
  }
potassium_case<-potassiumcase()

potassiumcontrol<-function(N){
    p1<-runif(N, min=371.38, max=1573.24)#371.38–1573.24
    p2<-runif(N, min=1573.85, max=1782.51)#1573.85–1782.51
    p3<-runif(N, min=1783.26, max=1956.03)#1783.26–1956.03
    p4<-runif(N, min=1958.1,  max=2234.83)#1958.1– 2234.83
    p5<-runif(N, min=2236.52, max=4401.3)#2236.52–4401.3
    pvalue<-c(p1,p2,p3,p4,p5)
  }
potassium_control<-potassiumcontrol(197)

# selenium
seleniumcase<-function(){
    s1<-runif(127, min=21, max=46.58)
    s2<-runif(73, min=46.63, max=51.72)
    s3<-runif(69, min=51.76, max=57.11)
    s4<-runif(59, min=57.11,  max=61.96)
    s5<-runif(56, min=62.05, max=87.9)
    svalue<-c(s1,s2,s3,s4,s5)
  }
s_case<-seleniumcase()

seleniumcontrol<-function(N){
  s1<-runif(N, min=21, max=46.58)
  s2<-runif(N, min=46.63, max=51.72)
  s3<-runif(N, min=51.76, max=57.11)
  s4<-runif(N, min=57.11,  max=61.96)
  s5<-runif(N, min=62.05, max=87.9)
  svalue<-c(s1,s2,s3,s4,s5)
}
s_control<-seleniumcontrol(197)

# beta-carotene
BetaCarotenecase<-function(){
    bc1<-runif(126, min=96.53, max=786.75)
    bc2<-runif(106, min=787.43, max=1130.49)
    bc3<-runif(62, min=1131.92, max=1436.65)
    bc4<-runif(56, min=1438.54,  max=2068.35)
    bc5<-runif(34, min=2072.85, max=13001.63)
    bcvalue<-c(bc1,bc2,bc3,bc4,bc5)
  }
bc_case<-BetaCarotenecase() 

BetaCarotenecontrol<-function(N){
  bc1<-runif(N, min=96.53, max=786.75)
  bc2<-runif(N, min=787.43, max=1130.49)
  bc3<-runif(N, min=1131.92, max=1436.65)
  bc4<-runif(N, min=1438.54,  max=2068.35)
  bc5<-runif(N, min=2072.85, max=13001.63)
  bcvalue<-c(bc1,bc2,bc3,bc4,bc5)
}
bc_control<-BetaCarotenecontrol(197) 

#Lutein and Zeaxanthin 
lucase<-function(){
  lu1<-runif(122, min=67.23, max=656.04)
  lu2<-runif(105, min=656.17, max=877.85)
  lu3<-runif(70, min=880.28, max=1142.48)
  lu4<-runif(61, min=1145.8,  max=1628.47)
  lu5<-runif(26, min=1628.52, max=15073.02)
  luvalue<-c(lu1,lu2,lu3,lu4,lu5)
}
lu_case<-lucase()
lucontrol<-function(N){
  lu1<-runif(N, min=67.23, max=656.04)
  lu2<-runif(N, min=656.17, max=877.85)
  lu3<-runif(N, min=880.28, max=1142.48)
  lu4<-runif(N, min=1145.8,  max=1628.47)
  lu5<-runif(N, min=1628.52, max=15073.02)
  luvalue<-c(lu1,lu2,lu3,lu4,lu5)
}
lu_control<-lucontrol(197)

#Niacin
ncase<-function(){
    n1<-runif(97, min=3.36, max=10.66)
    n2<-runif(96, min=10.67, max=12.07)
    n3<-runif(51, min=12.09, max=13.29)
    n4<-runif(82, min=13.29,  max=15.35)
    n5<-runif(58, min=15.35, max=37.11)
    nvalue<-c(n1,n2,n3,n4,n5)
  }
n_case<-ncase()
ncontrol<-function(N){
  n1<-runif(N, min=3.36, max=10.66)
  n2<-runif(N, min=10.67, max=12.07)
  n3<-runif(N, min=12.09, max=13.29)
  n4<-runif(N, min=13.29,  max=15.35)
  n5<-runif(N, min=15.35, max=37.11)
  nvalue<-c(n1,n2,n3,n4,n5)
}
n_control<-ncontrol(197)

# alpha-carotene
acarocase<-function(){
  a_caro1<-runif(135, min=14.99, max=163.08)
  a_caro2<-runif(89, min=163, max=244.31)#1
  a_caro3<-runif(68, min=244.37, max=322.05)
  a_caro4<-runif(46, min=322.39, max=464.26)
  a_caro5<-runif(46, min=466.3, max=1640.25)
  nvalue<-c(a_caro1,a_caro2,a_caro3,a_caro4,a_caro5)
  
}
acaro_case<-acarocase()

acarocontrol<-function(N){
  a_caro1<-runif(N, min=14.99, max=163.08)
  a_caro2<-runif(N, min=163, max=244.31)
  a_caro3<-runif(N, min=244.37, max=322.05)
  a_caro4<-runif(N, min=322.39, max=464.26)
  a_caro5<-runif(N, min=466.3, max=1640.25)
  nvalue<-c(a_caro1,a_caro2,a_caro3,a_caro4,a_caro5)
}
acaro_control<-acarocontrol(197)

#vitamin B6
v6case<-function(){
  v1<-runif(131, min=0.26, max=0.93)
  v2<-runif(67, min=0.93, max=1.04)
  v3<-runif(74, min=1.04, max=1.18)
  v4<-runif(60, min=1.18,  max=1.35)
  v5<-runif(52, min=1.35, max=3.71)
  vvalue<-c(v1,v2,v3,v4,v5)
}
v6_case<-v6case()

v6control<-function(N){
  v1<-runif(N, min=0.26, max=0.93)
  v2<-runif(N, min=0.93, max=1.04)
  v3<-runif(N, min=1.04, max=1.18)
  v4<-runif(N, min=1.18,  max=1.35)
  v5<-runif(N, min=1.35, max=3.71)
  vvalue<-c(v1,v2,v3,v4,v5)
}
v6_control<-v6control(197)

# vitaminc
vccase<-function(){
  v1<-runif(108, min=8.14, max=42.79)
  v2<-runif(84, min=42.84, max=59.53)
  v3<-runif(77, min=59.62, max=77.09)
  v4<-runif(57, min=77.14,  max=99.02)
  v5<-runif(58, min=99.18, max=301.49)
  vvalue<-c(v1,v2,v3,v4,v5)
}
vc_case<-vccase()
vccontrol<-function(N){
  v1<-runif(N, min=8.14, max=42.79)
  v2<-runif(N, min=42.84, max=59.53)
  v3<-runif(N, min=59.62, max=77.09)
  v4<-runif(N, min=77.14,  max=99.02)
  v5<-runif(N, min=99.18, max=301.49)
  vvalue<-c(v1,v2,v3,v4,v5)
}
vc_control<-vccontrol(197)
```

Combine case dataset and control dataset, scramble randomly the order of a data set , give each vaiable a unified name, and remove missing data. 

```{r}
## conbine conotrol and case datesets into one dataset
cancer.case<-rep(1,384)
case.df<-data.frame( 
                    sample(age_case),
                    sample(drinkscase),
                    sample(diabetecase),
                    sample(magcase_data),
                    sample(potassium_case),
                    sample(s_case),
                    sample(bc_case),
                    sample(lu_case),
                    sample(n_case),
                    sample(acaro_case),
                    sample(v6_case),
                    sample(vc_case),
                    cancer.case
                    )

names(case.df)<-c('age','drinks','diabetes','magnesium',
                  'potassium','selenium','betacarotene',
                  'lutein','niacin','alphacarotene','vitaminB6','vitaminC',
                  'cancer')
                  
cancer.control<-rep(0,985)
control.df<-data.frame(
                       sample(age_control),
                       sample(drinkscontrol),
                       sample(diabetecontrol),
                       sample(magcontrol_data),
                       sample(potassium_control),
                       sample(s_control),
                       sample(bc_control),
                       sample(lu_control),
                       sample(n_control),
                       sample(acaro_control),
                       sample(v6_control),
                       sample(vc_control),
                       cancer.control
                       )
names(control.df)<-c('age','drinks','diabetes','magnesium',
                     'potassium','selenium','betacarotene',
                     'lutein','niacin','alphacarotene','vitaminB6','vitaminC',
                     'cancer')


df<-rbind(control.df,case.df)%>%filter(diabetes!='Missing')
```

### Data exploration

```{r}
#summary
summary(df)
```

#### Use Pearson correlation score to see the correlation between each variable.

```{r}
cors<-cor(select(df,-diabetes))
corrplot(cors,method='color')
```

#### Plots were created to visulize distribution of each variable and their the relationship.

```{r}
hist(df$age)
hist(df$drinks)
hist(df$cancer)

g <- ggplot(df)
g+geom_density(aes(diabetes, fill =as.factor(cancer)), alpha=0.3)+
  ggtitle("Distribution  of diabetes patients")+
  guides(fill=guide_legend(title="pancreatic cancer"))


g+geom_boxplot(aes(x=as.factor(cancer),y=magnesium,fill=as.factor(cancer)))+
  ggtitle("Distribution  of magnesium by cancer")+xlab('cancer')+ylab('Magnesium (mg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=potassium,fill=as.factor(cancer)))+
  ggtitle("Distribution  of potassium by cancer")+xlab('cancer')+ylab('potassium (mg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=selenium,fill=as.factor(cancer)))+
  ggtitle("Distribution  of selenium by cancer")+xlab('cancer')+ylab('selenium (mcg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=alphacarotene,fill=as.factor(cancer)))+
  ggtitle("Distribution  of alphacarotene by cancer")+xlab('cancer')+ylab('alphacarotene (mcg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=betacarotene,fill=as.factor(cancer)))+
  ggtitle("Distribution  of betacarotene by cancer")+xlab('cancer')+ylab('betacarotene (mcg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=lutein,fill=as.factor(cancer)))+
  ggtitle("Distribution  of lutein by cancer")+xlab('cancer')+ylab('lutein (mcg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=niacin,fill=as.factor(cancer)))+
  ggtitle("Distribution  of niacin by cancer")+xlab('cancer')+ylab('niacin (mg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))
  
g+geom_boxplot(aes(x=as.factor(cancer),y=vitaminB6,fill=as.factor(cancer)))+
  ggtitle("Distribution  of vitaminB6 by cancer")+xlab('cancer')+ylab('vitaminB6 (mg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

g+geom_boxplot(aes(x=as.factor(cancer),y=vitaminC,fill=as.factor(cancer)))+
  ggtitle("Distribution  of vitaminC by cancer")+xlab('cancer')+ylab('vitaminC (mg/1000cal)')+
  guides(fill=guide_legend(title="pancreatic cancer"))

```

#### Create models:

First of all, becase diabetes is a risk of pancreatic cancer, use all the the variables except diabetes to fit the logistic regression model fit1 in order to avoid the result will be affected by diabetes.

```{r}
# models
fit1<-glm(cancer~.,family = binomial(link = "logit"),data=select(df,-diabetes))
summary(fit1)
```

Then, remove none significant variables age and drinks to fit model fit2.
```{r}
fit2<-glm(cancer~.,family = binomial(link = "logit"),data=select(df,-c(age,drinks,diabetes)) )
summary(fit2)

```

fit3 model include diabetes variable and nutrient variables in model fit2.
```{r}
fit3<-glm(cancer~.,family = binomial(link = "logit"),data=select(df,-c(age,drinks)))
summary(fit3)
```

# Results and Analysis

From correlation plot, we could see that nutrient predictor variables have negative correaltion with response variable cancer. Some nutrient variable have positve correaltion such as magnesium and potassium, lutein and potassium.

From the plots, we could see that age has normal distribution. age of most participants are between 60-70 years old. Drinks is uniform distribution. Diabetes plot shows that  no diabetes participants account for the largest percentage. No diabetes accounts for the largest percentage in both case and control groups. Diabetes less than 3 years in case group accounts for larger percentage than in control group,but less percentage of diabetes more than 3 years. 

Boxplots show the median, max, min and range of each nutrient variable in case and control group. We could see that in each case group, the median nutrient intake is slightly higher than in control group, which might indicate that larger amount of nutrient intake might be accosicate with decreased pancreatic cancer rate.

Fit1 model shows all nutrient variables are significant, age and drinks are not significant at 0.05 level, but AIC socre is high. Fit2 model includes only  the significant nutrient variables , but AIC score was not decreased after removing none significant variables.

Because diabetes is a known risk factor for pancreatic cancer and because diabetics are advised to modify their diet, the study investigated whether adding diabetes (categorized as no diabetes, diabetes diagnosis less than 3 years prior to completing questionnaire, or diabetes diagnosis 3 years or more prior to questionnaire) to the logistic model would significantly change our results. The result of fit 3 model shows that diabetes is significant coefficients with response variable cancer. After adding it, we did not find any nutrient categories changed in significance for trend p-value except niacin. 

Conclusion: nutrients magnesium, potassium, selenium, beta-carotene, lutein, niacin,alpha-carotene, vitaminB6,vitaminC obtained through consumption of vegetabels and fruits might reduce the risk of developing pancreatic cancer, and the result did not affected by the diabetes. Model classification power is not strong, but with more data involved, the model performance might become better.
 


